name: password-leak-mitigation
type: shell
commands:
- echo '#!/usr/bin/bash' > /usr/bin/__clear_first_setup_steps
- echo 'echo "" > /etc/org.vanillaos.FirstSetup.commands' >> /usr/bin/__clear_first_setup_steps
- chmod +x /usr/bin/__clear_first_setup_steps
- echo '[Unit]' > /etc/systemd/system/clear-first-setup-steps.service
- echo 'After=local-fs.target' >> /etc/systemd/system/clear-first-setup-steps.service
- echo '' >> /etc/systemd/system/clear-first-setup-steps.service
- echo '[Service]' >> /etc/systemd/system/clear-first-setup-steps.service
- echo 'ExecStart=/usr/bin/__clear_first_setup_steps' >> /etc/systemd/system/clear-first-setup-steps.service
- echo 'Type=oneshot' >> /etc/systemd/system/clear-first-setup-steps.service
- mkdir -p /etc/systemd/system/local-fs.target.wants
- ln -s ../clear-first-setup-steps.service /etc/systemd/system/local-fs.target.wants/
- chmod +x /etc/systemd/system/clear-first-setup-steps.service
